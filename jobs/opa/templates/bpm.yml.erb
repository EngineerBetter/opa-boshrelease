processes:
- name: opa
  executable: /var/vcap/packages/opa/opa
  args:
  - run
  - --server
  - --addr=<%= p('addr') %>
  - --authentication=<%= p('authentication') %>
  - --authorization=<%= p('authorization') %>
  - --format=<%= p('format') %>
  - --log-format=<%= p('log-format') %>
  - --log-level=<%= p('log-level') %>
  - --max-errors=<%= p('max-errors') %>
  - --server-diagnostics-buffer-size=<%= p('server-diagnostics-buffer-size') %>
<% if_p('tls') do |tls| %>
  - --tls-cert-file=/var/vcap/jobs/opa/config/tls.crt
  - --tls-private-key-file=/var/vcap/jobs/opa/config/tls.key
<% end %>
  config/policy.rego
